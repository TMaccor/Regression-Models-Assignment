---
title: "Regression Models - Course Assignment"
author: "TomÃ¡s A. Maccor"
date: "25/2/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Executive Summary

Motor Trend, the premier automobile industry magazine, once again delivers one of its special reports!:

This time, we analyse the relationship between Miles per Galon (MPG) in Automatic versus Manual transmission motor vehicles. 
We reviewed an extensive dataset belonging to a collection of representative vehicles around the world, and a after running a series of models to fit the data, we have found that:

- Vechicles with Manual transmission deliver more MPG than the ones that have Automatic transmission.
- The quantifiable difference is 11.06 more MPG for Manual transmission vehicles, but this quantity also needs to be adjusted by the vehicle's weight -the product of the car's weigth (pounds / 1000) times -3.64 needs to be substracted to 11.06 MPG, to obtain the actual difference in MPG, for auto & manual cars of the same weight).


## Exploratory Data Analysis on the dataset

Loading the dataset & having a first glimpse:

```{r}
library(tidyverse)
data("mtcars")
mtcars -> motorcars
str(motorcars)
```

All dataset variables are NUMERIC.
We rename the variable that containg the tranmission information, to "TRANSMISSION", for easy of understanding at follow up & in plots.

Transmission = 0 equals an AUTOMATIC Transmision
Transmission = 1 equals MANUAL Transmision

We do the first exploratory & visualization plot (see Appendices, Plot 1), where we see a visual 
difference of approximately 5 MPG better performance by MANUAL Tranmission automoviles (within this sample of vehicles).

```{r}
motorcars <- rename(motorcars, Transmission = am)
motorcars$Transmission <- as.factor(motorcars$Transmission)

plot1 <- ggplot(motorcars, aes(Transmission, mpg, fill=Transmission))
plot1 + geom_boxplot() + scale_fill_discrete(name = "Transmission", labels = c("Automatic", "Manual"))
```

## Statistical Analysis 

We now check for a statistically significant difference between the 2 transmission types: 

```{r}
t.test(motorcars$mpg ~ motorcars$Transmission)
```

And we see there is a statistically significant difference between the means of these 2 groups (p = 0,001374).
Manual Tranmission = 17.147 MPG
Automatic = 24.392 MPG


## MODELLING

We will try to find the best model that explains the data, and best quantifies the difference in MPG for these 2 vehicle POPULATIONS.

# 1. Simplest model
We will firstly run a model that only uses the TRANMISSION to explain the data:

```{r}
lm_mpg_only <- lm(mpg ~ Transmission, data = motorcars)  
summary(lm_mpg_only)
```

This model only explains explains 36% of total variability (R2 = 0.3598). In addition, the residuals plot (see Plot #2 in Appendices) shows a very clear pattern of aggregation along the X axis, which is not supposed to be.

# 2. LINEAR model with ALL VARIABLES

```{r}
lm_mpg_all <- lm(mpg ~ . , data = motorcars)  
summary(lm_mpg_all)
```

This model is much better, it explains 87% of total variability: R2 = 0.87, and the RSE is lower (2.65) than for our 1st model. 
BUT....none of the model's coefficients are statistically significant. There's just too many predictors that have been inserted into the model.

If we run a correlation between all variables in the dataset:

```{r}
correlations <- cor(motorcars)
```

We can see that the variables most correlated with MPG are CYL (# of cilynders), DISP (Displacement), wt (WEIGHT) & HP (horsepower).  

Thus, our next model will only have these variables + TRANSMISSION type:


```{r}
lm_mpg_all_correlated <- lm(mpg ~ Transmission + cyl + disp + hp + wt, data = motorcars)
```

This 3rd model explains 86% of total variability.  And RSE (residual variation) is LOWER than 
for the 2nd model: RSE = 2,50.
BUT...the only statistically significant coefficient is the WEIGHT  (and TRANSMISSION is NOT)

After researching some of our other sources, we see that most often automatic transmission vehicles are heavier that the ones with manual transmission (due to the characteristics of the transmission itself). Thus, the TRANSMISSION variable interacts with the WEIGHT variable (since if Automatic Transmission vehicle, its weight will most likely be heavier), thus we will run a 4th model including the INTERACTION TERM between Transmission & Weight: 


```{r}
lm_mpg_with_interaction <- lm(mpg ~ Transmission + Transmission:wt + cyl + disp + hp + wt, data = motorcars)
summary(lm_mpg_with_interaction)
```

The result is a model with even better fit (R2 = 88%) and better residual fit (RSE = 2,31), PLUS is statistically significant for the "Transmission" & the "Transmission:wt" coefficients.

If we do the residuals plot, all seems adequate (no distinc patterns, see Plot #3)

Finally, if we do an ANOVA test, the results are tell us we have found the best model to explain data and obtain insights:



```{r}
anova(lm_mpg_only, lm_mpg_with_interaction, lm_mpg_all_correlated, lm_mpg_all)
```

If we only consider tranmission as a predictor of MPG, the difference between Automatic vs. Manual
is that we can expect to obtain 7,xx  MPG with Manual Transmission.
If we consider other variables than when included in our model of MPG consumption, result in a
more robust model (more accurate), then the increase in MPG when using manual is 2,XX

## 95% Confidence interval para valores de MPG vs Auto/Manual:
sumCoef_all_correlated <- summary(lm_mpg_all_correlated)$coefficients
(sumCoef_all_correlated[2,1] + c(-1, 1) * qt(.975, df = lm_mpg_all_correlated$df) * sumCoef_all_correlated[2, 2])
## Da -1.404573 y 4.517556  MPG para Transmission  


LOGISTIC or POISSON models are not applicable in this case  --the outcome variable (MPG) is not
binomial neither count data

```{r}



```



```{r}
lm_mpg_all_correlated <- lm(mpg ~ Transmission + cyl + disp + hp + wt, data = motorcars)
```

